<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Happy Birthday Naomie üéÇ</title>

<style>
:root{ --bgImg: url("bg.jpg"); }
*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:#111;
  background:
    radial-gradient(1200px 500px at 50% 60%, rgba(0,0,0,.08), transparent 65%),
    linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.72)),
    var(--bgImg);
  background-size:cover;
  background-position:center;
}

/* CONFETTI CANVAS */
#confetti{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:9999;
}

.card{
  width:min(860px,92vw);
  background:rgba(255,255,255,.72);
  border-radius:28px;
  padding:30px;
  backdrop-filter:blur(12px);
  box-shadow:0 30px 90px rgba(0,0,0,.18);
  text-align:center;
  position:relative;
  overflow:auto;
  max-height:92vh;
  -webkit-overflow-scrolling:touch;
}

h1{ font-size:34px; margin:0 0 10px; }
p{ margin:0; opacity:.92; line-height:1.55; }

button{
  margin-top:20px;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  cursor:pointer;
  font-weight:900;
  background:linear-gradient(135deg,#E35619,#FFBDF8);
  color:#fff;
  box-shadow:0 14px 40px rgba(0,0,0,.12);
  transition:.2s;
}
button:hover{ transform:translateY(-2px); }

.slide{ display:none; }
.slide.active{ display:block; }

.heroImage{
  width:min(520px,92%);
  margin:0 auto 16px;
}
.heroImage img{ width:100%; height:auto; display:block; object-fit:contain; }

/* ===== PHOTO BOX ===== */
.photoBox{
  width:min(640px,96%);
  margin:18px auto 0;
  border-radius:22px;
  overflow:hidden;
  aspect-ratio:16/9;
  box-shadow:0 18px 60px rgba(0,0,0,.10);
  background:rgba(255,255,255,.65);
}
.photoBox img{
  width:100%;
  height:100%;
  object-fit:contain;
  display:block;
  background:rgba(255,255,255,.75);
}

/* ‚úÖ image sans fond */
.photoBox.noBg{ background:transparent; box-shadow:none; }
.photoBox.noBg img{ background:transparent !important; }

/* square group */
.photoBox.square{
  aspect-ratio:1/1;
  width:min(520px,92%);
}

/* =========================
   SLIDE "OHLALA"
   ========================= */
.bigBold{
  font-size:30px;
  font-weight:1000;
  line-height:1.05;
  margin:0 0 10px;
  letter-spacing:-.3px;
}
.subText{
  font-size:16px;
  font-weight:650;
  opacity:.92;
}

/* =========================
   COUNTDOWN OVERLAY
   ========================= */
#countdownOverlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:10000;
  background:rgba(0,0,0,.28);
  backdrop-filter:blur(6px);
}
#countdownOverlay.show{ display:flex; }

.countPill{
  background:#fff;
  border-radius:26px;
  padding:22px 28px;
  box-shadow:0 30px 90px rgba(0,0,0,.25);
  min-width:min(320px,86vw);
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
  justify-content:center;
}
.countNum{
  font-weight:1000;
  font-size:72px;
  line-height:1;
  letter-spacing:-2px;
}
.countHint{
  font-weight:850;
  opacity:.9;
}

/* =========================
   GIFT SLIDE
   ========================= */
.giftSlide{
  position:relative;
  min-height:610px;
  padding:16px 8px 12px;
}

.floatZone{
  position:absolute;
  inset:-22px;
  pointer-events:none; /* ‚úÖ emojis only */
  z-index:2;
}

.giftContent{
  position:relative;
  z-index:10;
  width:100%;
}

/* Title (smaller + phone friendly) */
.giftTitle{
  font-size:28px;
  font-weight:1000;
  margin:0 0 10px;
  letter-spacing:-.4px;
  line-height:1.08;
}
.giftTitle .wiggle{
  display:inline-block;
  padding:9px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.92);
  box-shadow:0 18px 55px rgba(0,0,0,.12);
  animation:wiggle 1.6s ease-in-out infinite;
}
@keyframes wiggle{
  0%{ transform:rotate(-0.8deg) translateY(0); }
  50%{ transform:rotate(0.8deg) translateY(-1px); }
  100%{ transform:rotate(-0.8deg) translateY(0); }
}

/* ‚úÖ espace image (PNG sans fond) */
.giftImage{
  width:min(700px,96%);
  margin:10px auto 14px;
  background:transparent;
}
.giftImage img{
  width:100%;
  height:auto;
  max-height:clamp(240px, 42vh, 460px);
  display:block;
  object-fit:contain;
  background:transparent;
}

/* ‚úÖ pill NON transparent + rose */
.giftPill{
  width:min(720px,94%);
  margin:0 auto;
  padding:16px 18px;
  border-radius:999px;
  background:#fff;
  box-shadow:0 16px 55px rgba(0,0,0,.12);
  font-weight:1000;
  opacity:1;
  color:#FFBDF8; /* ‚úÖ rose */
}

/* footnote */
.giftFootnote{
  margin-top:10px; /* ‚úÖ remonte (suppression de l'espace "options") */
  font-size:14px;
  font-weight:900;
  color:#E35619;
}
.giftFootnote b{ font-weight:1000; }

/* ‚úÖ floating emojis only */
.emojiFloat{
  position:absolute;
  transform:translate(-50%,-50%);
  pointer-events:none;
  opacity:.25;
  filter:drop-shadow(0 10px 16px rgba(0,0,0,.10));
  will-change:transform,left,top;
  transition:opacity .5s ease;
}
.emojiFloat.show{ opacity:.30; }

@media (max-width:520px){
  .card{ padding:18px; width:min(920px,94vw); border-radius:24px; }
  h1{ font-size:26px; }
  p{ font-size:15px; }
  button{ width:100%; }
  .bigBold{ font-size:26px; }
  .subText{ font-size:15px; }
  .giftTitle{ font-size:22px; }
  .giftImage img{ max-height:clamp(220px, 40vh, 380px); }
  .giftPill{ border-radius:22px; padding:14px 14px; font-size:15px; }
  .countNum{ font-size:64px; }
}
</style>
</head>

<body>

<canvas id="confetti"></canvas>

<!-- COUNTDOWN OVERLAY -->
<div id="countdownOverlay" aria-hidden="true">
  <div class="countPill">
    <div class="countNum" id="countNum">5</div>
    <div class="countHint" id="countHint">Pr√©pare-toi‚Ä¶ üéÅ</div>
  </div>
</div>

<div class="card" id="card">

  <!-- SLIDE 0 -->
  <div class="slide active">
    <div class="heroImage">
      <img id="imgHero" alt="">
    </div>
    <h1>Happy Birthday ma ch√©rie üéâ</h1>
    <p>Pr√™te pour la suite ? üëÄ</p>
    <button onclick="burstAndNextGeneric(event)">D√©bloque la suite üîì</button>
  </div>

  <!-- SLIDE 1 (OHLALA) -->
  <div class="slide">
    <div class="bigBold">On pense √† toi, et on veut que tu te d√©tendes‚Ä¶</div>
    <div class="subText">
      Donc pour tes <b>27 ans</b>, on te souhaite‚Ä¶<br>
      <b>un cr√¢ne bien d√©tendu.</b>
    </div>

    <div class="photoBox noBg" style="margin-top:16px;">
      <img id="imgOhlala" alt="">
    </div>

    <button onclick="burstAndNextGeneric(event)">D√©bloque la suite üîì</button>
  </div>

  <!-- SLIDE 2 (DE LA PART DE) -->
  <div class="slide">
    <h1 style="font-size:22px; font-weight:950; margin-bottom:8px;">
      üíû M√™me si tu es loin, on voulait c√©l√©brer ce moment avec toi!
    </h1>

    <div class="photoBox square">
      <img id="imgGroup" alt="">
    </div>

    <button onclick="countdownToGift(event)">D√©bloque ton cadeau üéÅ</button>
  </div>

  <!-- SLIDE 3 (GIFT) -->
  <div class="slide giftSlide" id="giftSlide">
    <div class="floatZone" id="floatZone" aria-hidden="true"></div>

    <div class="giftContent">
      <div class="giftTitle">
        <span class="wiggle"> üíÜ‚Äç‚ôÄÔ∏è Une S√©ance de Head Spa  üíÜ‚Äç‚ôÄÔ∏è</span>
      </div>

      <div class="giftImage">
        <img id="imgToiBientot" alt="">
      </div>

      <div class="giftPill">
        Une s√©ance compl√®te incluant d√©tente profonde et soin capillaire pour ton petit cr√¢ne d√©licat.
      </div>

      <!-- ‚úÖ OPTIONS SUPPRIM√âES (loopArea / loopPill) -->

      <div class="giftFootnote">
        Merci de contacter <b>Mme Lucie Dubourdieu</b> pour r√©cup√©rer votre lot üëÆ‚Äç‚ôÇÔ∏è
      </div>
    </div>
  </div>

</div>

<script>
/* =========================
   MEDIA FALLBACKS
   ========================= */
const MEDIA = {
  bases: ["", "images/"],
  bg: "bg",
  hero: "monanniversaire",
  group: "lessurvivors",
  ohlala: "ohlala",
  toibientot: "toibientot"
};
const EXT = [".png",".jpg",".jpeg"];

function tryLoad(url){
  return new Promise((resolve,reject)=>{
    const img = new Image();
    img.onload = ()=>resolve(url);
    img.onerror = ()=>reject(url);
    img.src = url;
  });
}

async function setImgSmart(id, name){
  const el = document.getElementById(id);
  if(!el) return;
  const hasExt = /\.[a-zA-Z0-9]{3,4}$/.test(name);

  for(const base of MEDIA.bases){
    if(hasExt){
      const url = base + name;
      try{ await tryLoad(url); el.src = url; return; }catch(e){}
    }else{
      for(const ext of EXT){
        const url = base + name + ext;
        try{ await tryLoad(url); el.src = url; return; }catch(e){}
      }
    }
  }
}

async function setBgSmart(name){
  const hasExt = /\.[a-zA-Z0-9]{3,4}$/.test(name);

  for(const base of MEDIA.bases){
    if(hasExt){
      const url = base + name;
      try{ await tryLoad(url); document.documentElement.style.setProperty("--bgImg", `url("${url}")`); return; }catch(e){}
    }else{
      for(const ext of EXT){
        const url = base + name + ext;
        try{ await tryLoad(url); document.documentElement.style.setProperty("--bgImg", `url("${url}")`); return; }catch(e){}
      }
    }
  }
}

(async function initMedia(){
  await setBgSmart(MEDIA.bg);
  await setImgSmart("imgHero", MEDIA.hero);
  await setImgSmart("imgGroup", MEDIA.group);
  await setImgSmart("imgOhlala", MEDIA.ohlala);
  await setImgSmart("imgToiBientot", MEDIA.toibientot);
})();

/* =========================
   CONFETTI ENGINE
   ========================= */
const Confetti = (function(){
  const c = document.getElementById("confetti");
  const ctx = c.getContext("2d");
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

  function resize(){
    c.width = Math.floor(window.innerWidth * DPR);
    c.height = Math.floor(window.innerHeight * DPR);
    c.style.width = window.innerWidth + "px";
    c.style.height = window.innerHeight + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener("resize", resize);
  resize();

  const colors = ["#E35619","#FFBDF8","#ffd166","#06d6a0","#118ab2","#9b5de5"];
  const pieces = [];
  const MAX = 200;

  let activeCount = 160;
  let alpha = 0.90;
  let speedMult = 1.0;
  let windMult = 1.0;

  function spawnTop(){
    return {
      x: Math.random()*window.innerWidth,
      y: -20 - Math.random()*window.innerHeight*0.35,
      r: 3 + Math.random()*4,
      w: 6 + Math.random()*8,
      h: 8 + Math.random()*12,
      vy: 1.4 + Math.random()*3.6,
      vx: -0.9 + Math.random()*1.8,
      rot: Math.random()*Math.PI*2,
      vr: (-0.10 + Math.random()*0.20),
      color: colors[(Math.random()*colors.length)|0],
      shape: Math.random() < 0.55 ? "rect" : "circle"
    };
  }

  const bursts = [];
  function spawnBurst(x,y,type){
    const n = type === "sparkle" ? 70 : 120;
    for(let i=0;i<n;i++){
      const ang = Math.random()*Math.PI*2;
      const spd = (type === "sparkle" ? 2.2 : 2.8) + Math.random()*(type==="sparkle"?3.0:4.2);
      bursts.push({
        kind:type,
        x, y,
        vx: Math.cos(ang)*spd,
        vy: Math.sin(ang)*spd - (type==="sparkle"?1.0:0.2),
        rot: Math.random()*Math.PI*2,
        vr: (-0.25 + Math.random()*0.5),
        size: type==="sparkle" ? (1.5+Math.random()*2.5) : (3+Math.random()*5),
        w: type==="sparkle" ? (2+Math.random()*3) : (5+Math.random()*7),
        h: type==="sparkle" ? (2+Math.random()*3) : (7+Math.random()*10),
        color: type==="sparkle" ? "rgba(255,255,255,.95)" : colors[(Math.random()*colors.length)|0],
        shape: type==="sparkle" ? "star" : (Math.random()<0.55?"rect":"circle"),
        life: type==="sparkle" ? (26+Math.random()*12) : (34+Math.random()*18)
      });
    }
  }

  function burstAtClientXY(clientX, clientY, big=false){
    spawnBurst(clientX, clientY-10, "sparkle");
    spawnBurst(clientX, clientY-10, "confetti");
    if(big){
      setTimeout(()=>{
        spawnBurst(clientX, clientY-10, "sparkle");
        spawnBurst(clientX, clientY-10, "confetti");
      }, 140);
    }
  }

  for(let i=0;i<MAX;i++) pieces.push(spawnTop());

  function setMode(mode){
    if(mode === 0){
      activeCount = 160; alpha = 0.90; speedMult = 1.00; windMult = 1.00;
    }else{
      activeCount = 65;  alpha = 0.22; speedMult = 0.42; windMult = 0.55;
    }
  }

  let target = {activeCount, alpha, speedMult, windMult};
  function setModeSoft(mode){
    setMode(mode);
    target = {activeCount, alpha, speedMult, windMult};
  }
  function lerp(a,b,t){ return a + (b-a)*t; }

  function step(){
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    activeCount = Math.round(lerp(activeCount, target.activeCount, 0.08));
    alpha      = lerp(alpha,      target.alpha,      0.08);
    speedMult  = lerp(speedMult,  target.speedMult,  0.08);
    windMult   = lerp(windMult,   target.windMult,   0.08);

    for(let i=0;i<activeCount;i++){
      const p = pieces[i];
      p.x += p.vx * windMult;
      p.y += p.vy * speedMult;
      p.rot += p.vr;
      p.vx += Math.sin(p.y*0.01 + p.rot) * 0.012 * windMult;

      if(p.y > window.innerHeight + 40) pieces[i] = spawnTop();

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = p.color;
      if(p.shape === "rect"){
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      }else{
        ctx.beginPath();
        ctx.arc(0,0,p.r,0,Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
    }

    for(let i=bursts.length-1;i>=0;i--){
      const b = bursts[i];
      b.life -= 1;

      b.vx *= 0.985;
      b.vy *= 0.985;
      b.vy += (b.kind==="sparkle" ? 0.06 : 0.09);

      b.x += b.vx; b.y += b.vy; b.rot += b.vr;

      const fade = Math.max(0, Math.min(1, b.life / 30));
      ctx.save();
      ctx.translate(b.x, b.y);
      ctx.rotate(b.rot);
      ctx.globalAlpha = b.kind==="sparkle" ? (0.9*fade) : (0.95*fade);

      if(b.shape === "star"){
        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.moveTo(0, -b.size*2);
        ctx.lineTo(b.size*0.7, -b.size*0.7);
        ctx.lineTo(b.size*2, 0);
        ctx.lineTo(b.size*0.7, b.size*0.7);
        ctx.lineTo(0, b.size*2);
        ctx.lineTo(-b.size*0.7, b.size*0.7);
        ctx.lineTo(-b.size*2, 0);
        ctx.lineTo(-b.size*0.7, -b.size*0.7);
        ctx.closePath();
        ctx.fill();
      }else if(b.shape === "rect"){
        ctx.fillStyle = b.color;
        ctx.fillRect(-b.w/2, -b.h/2, b.w, b.h);
      }else{
        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.arc(0,0,b.size,0,Math.PI*2);
        ctx.fill();
      }
      ctx.restore();

      if(b.life <= 0 || b.y > window.innerHeight + 60) bursts.splice(i,1);
    }

    requestAnimationFrame(step);
  }
  step();

  return { setModeSoft, burstAtClientXY };
})();

/* =========================
   SLIDES
   ========================= */
let current=0;
const slides=document.querySelectorAll(".slide");
Confetti.setModeSoft(0);

function next(){
  slides[current].classList.remove("active");
  current++;
  slides[current].classList.add("active");
  Confetti.setModeSoft(current >= 1 ? 1 : 0);

  if(slides[current].id === "giftSlide"){
    startEmojiFloat();
  }
}

function burstAndNextGeneric(e){
  const btn = e?.currentTarget;
  if(btn){
    const r = btn.getBoundingClientRect();
    Confetti.burstAtClientXY(r.left + r.width/2, r.top + r.height/2);
  }else{
    Confetti.burstAtClientXY(window.innerWidth/2, window.innerHeight/2);
  }
  setTimeout(()=>next(), 220);
}

function countdownToGift(e){
  const btn = e?.currentTarget;
  if(btn){
    const r = btn.getBoundingClientRect();
    Confetti.burstAtClientXY(r.left + r.width/2, r.top + r.height/2);
  }

  const overlay = document.getElementById("countdownOverlay");
  const numEl = document.getElementById("countNum");
  const hintEl = document.getElementById("countHint");

  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden","false");
  document.querySelectorAll("button").forEach(b=>b.disabled=true);

  const cx = window.innerWidth/2;
  const cy = window.innerHeight/2;

  let n = 5;
  numEl.textContent = n;
  hintEl.textContent = "Pr√©pare-toi‚Ä¶ üéÅ";
  Confetti.burstAtClientXY(cx, cy, false);

  const tick = () => {
    n--;
    if(n >= 1){
      numEl.textContent = n;
      Confetti.burstAtClientXY(cx, cy, false);
      setTimeout(tick, 520);
    }else{
      numEl.textContent = "1";
      Confetti.burstAtClientXY(cx, cy, true);

      setTimeout(()=>{
        overlay.classList.remove("show");
        overlay.setAttribute("aria-hidden","true");
        document.querySelectorAll("button").forEach(b=>b.disabled=false);

        Confetti.burstAtClientXY(cx, cy, true);
        setTimeout(()=>next(), 180);
      }, 620);
    }
  };

  setTimeout(tick, 520);
}

/* =========================
   GIFT PAGE - EMOJI FLOAT ONLY
   ‚úÖ each emoji 5x
   ========================= */
let emojiStarted=false;
const emojiBlobs=[];

function rand(a,b){ return Math.random()*(b-a)+a; }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

function startEmojiFloat(){
  if(emojiStarted) return;
  emojiStarted=true;

  const zone = document.getElementById("floatZone");

  const base = ["üßñ‚Äç‚ôÄÔ∏è","üçÉ","üßò‚Äç‚ôÄÔ∏è","‚òÅÔ∏è","üåø","ü§ç"];
  const emojis = [];
  base.forEach(e=>{
    for(let k=0;k<5;k++) emojis.push(e); // ‚úÖ 5 fois chacun
  });

  const isMobile = window.matchMedia("(max-width:520px)").matches;

  emojis.forEach((emo,i)=>{
    const el = document.createElement("div");
    el.className = "emojiFloat";
    el.textContent = emo;
    zone.appendChild(el);

    const x = rand(3, 97);
    const y = rand(3, 97);

    const blob = {
      el,
      baseX:x, baseY:y,
      x, y,
      vx:0, vy:0,
      phase:rand(0,Math.PI*2),
      drift:rand(0.6, 1.5),
      size: rand(isMobile?14:16, isMobile?18:22)
    };

    el.style.fontSize = blob.size + "px";
    emojiBlobs.push(blob);
    setTimeout(()=>el.classList.add("show"), 120 + i*14);
  });

  (function animate(){
    requestAnimationFrame(animate);
    const t = performance.now();
    const isMobileNow = window.matchMedia("(max-width:520px)").matches;
    const amp = isMobileNow ? 0.9 : 1.25;

    emojiBlobs.forEach(b=>{
      const levX = Math.sin(t*0.001 + b.phase) * (amp * 1.1 * b.drift);
      const levY = Math.cos(t*0.0011 + b.phase) * (amp * 0.9 * b.drift);

      const targetX = b.baseX + levX;
      const targetY = b.baseY + levY;

      b.vx += (targetX - b.x) * 0.02;
      b.vy += (targetY - b.y) * 0.02;

      b.vx *= 0.90; b.vy *= 0.90;
      b.x += b.vx;  b.y += b.vy;

      b.x = clamp(b.x, 2, 98);
      b.y = clamp(b.y, 2, 98);

      b.el.style.left = b.x + "%";
      b.el.style.top  = b.y + "%";
    });
  })();
}
</script>

</body>
</html>
