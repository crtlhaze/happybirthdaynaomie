<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Happy Birthday Naomie üéÇ</title>

<style>
:root{ --bgImg: url("bg.jpg"); }
*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:#111;
  background:
    radial-gradient(1200px 500px at 50% 60%, rgba(0,0,0,.08), transparent 65%),
    linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.72)),
    var(--bgImg);
  background-size:cover;
  background-position:center;
}

/* CONFETTI CANVAS */
#confetti{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:9999;
}

.card{
  width:min(820px,92vw);
  background:rgba(255,255,255,.72);
  border-radius:28px;
  padding:30px;
  backdrop-filter:blur(12px);
  box-shadow:0 30px 90px rgba(0,0,0,.18);
  text-align:center;
  position:relative;
  overflow:hidden;
}

h1{ font-size:34px; margin:0 0 10px; }
p{ margin:0; opacity:.9; line-height:1.5; }

button{
  margin-top:20px;
  padding:12px 20px;
  border-radius:14px;
  border:none;
  cursor:pointer;
  font-weight:900;
  background:linear-gradient(135deg,#E35619,#FFBDF8);
  color:#111;
  box-shadow:0 14px 40px rgba(0,0,0,.10);
  transition:.2s;
}
button:hover{
  transform:translateY(-2px);
  box-shadow:0 18px 60px rgba(0,0,0,.14);
}
button:active{ transform:translateY(0px) scale(.99); }

.slide{ display:none; }
.slide.active{ display:block; }

.heroImage{
  width:min(520px,92%);
  margin:0 auto 20px;
}
.heroImage img{ width:100%; display:block; }

/* Square full-size box (lessurvivors + ohlala) */
.squareBox{
  width:min(520px,92%);
  margin:18px auto 0;
  border-radius:22px;
  overflow:hidden;
  aspect-ratio:1/1;
  box-shadow:0 18px 60px rgba(0,0,0,.10);
  background:rgba(255,255,255,.65);
}
.squareBox img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* small photo spot on last slide */
.miniPhoto{
  width:min(360px,76%);
  margin:12px auto 0;
  border-radius:18px;
  overflow:hidden;
  aspect-ratio:4/3;
  box-shadow:0 18px 60px rgba(0,0,0,.10);
  background:rgba(255,255,255,.75);
}
.miniPhoto img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* =========================
   GIFT SLIDE
   ========================= */

.giftSlide{
  position:relative;
  min-height:560px;
  padding:18px 10px 10px;
}

.giftHeader{
  position:absolute;
  left:50%;
  top:40%;
  transform:translate(-50%,-50%);
  z-index:10;
  width:100%;
  pointer-events:none;
}

.giftTitle{
  font-size:34px;
  font-weight:1000;
  margin:0 0 10px;
  letter-spacing:-.2px;
  display:inline-block;
}

/* highlighted + fretille */
.giftTitle .wiggle{
  display:inline-block;
  padding:6px 12px;
  border-radius:16px;
  background:linear-gradient(135deg, rgba(255,255,255,.95), rgba(255,255,255,.72));
  box-shadow:
    0 18px 55px rgba(0,0,0,.10),
    0 0 0 1px rgba(255,255,255,.55) inset;
  position:relative;
  animation: wiggle 1.35s ease-in-out infinite, glow 2.2s ease-in-out infinite;
}
.giftTitle .wiggle::after{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:22px;
  background:radial-gradient(closest-side, rgba(255,255,255,.55), transparent 70%);
  filter:blur(8px);
  opacity:.55;
  z-index:-1;
}

@keyframes wiggle{
  0%,100%{ transform:translateY(0) rotate(0deg) scale(1); }
  25%{ transform:translateY(-1px) rotate(-0.6deg) scale(1.01); }
  50%{ transform:translateY(0) rotate(0.8deg) scale(1.02); }
  75%{ transform:translateY(1px) rotate(-0.4deg) scale(1.01); }
}
@keyframes glow{
  0%,100%{ filter:drop-shadow(0 10px 18px rgba(0,0,0,.12)); }
  50%{ filter:drop-shadow(0 14px 26px rgba(0,0,0,.16)); }
}

.giftStack{
  width:min(650px,92%);
  margin:12px auto 0;
  display:grid;
  gap:12px;
}

.giftPill{
  padding:16px 18px;
  border-radius:999px;
  background:rgba(255,255,255,.88);
  box-shadow:0 16px 55px rgba(0,0,0,.10);
  font-weight:650;
  opacity:.95;
}

.giftFootnote{
  position:absolute;
  left:50%;
  bottom:18px;
  transform:translateX(-50%);
  width:min(650px,92%);
  font-size:13px;
  color:#E35619;        /* <= demand√© */
  opacity:1;            /* pour que la couleur soit bien visible */
  z-index:10;
  pointer-events:none;
}
.giftFootnote b{ font-weight:900; }

/* bigger hover surface */
.floatZone{
  position:absolute;
  inset:-22px;
  pointer-events:auto;
  z-index:2;
}

/* floating items */
.tag, .emojiFloat{
  position:absolute;
  transform:translate(-50%,-50%);
  pointer-events:none;
  opacity:0;
  transition:opacity .55s ease, transform .55s ease;
  will-change:transform,left,top;
}

/* options: smaller font, no white pill */
.tag{
  padding:0;
  border-radius:0;
  background:transparent;
  box-shadow:none;
  font-weight:550;
  font-size:12px;
  white-space:nowrap;
  opacity:.9;
  text-shadow:0 10px 22px rgba(0,0,0,.10);
}

.emojiFloat{
  font-size:22px;
  filter:drop-shadow(0 10px 18px rgba(0,0,0,.12));
  opacity:.9;
}

.tag.show, .emojiFloat.show{
  opacity:1;
  transform:translate(-50%,-50%) scale(1);
}

/* =========================
   REVEAL ANIMATION (chest)
   ========================= */
.revealOverlay{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  z-index:30;
  pointer-events:none;
  opacity:0;
}
.revealOverlay.show{
  opacity:1;
  animation: overlayFade 1.35s ease forwards;
}

@keyframes overlayFade{
  0%{ opacity:0; }
  12%{ opacity:1; }
  75%{ opacity:1; }
  100%{ opacity:0; }
}

.chest{
  width:160px;
  height:130px;
  position:relative;
  transform:translateY(10px) scale(.95);
  filter:drop-shadow(0 22px 40px rgba(0,0,0,.18));
  animation: chestPop .45s cubic-bezier(.2,1.2,.2,1) forwards;
}
@keyframes chestPop{ to{ transform:translateY(0) scale(1); } }
.chest .base{
  position:absolute;
  left:0; right:0;
  bottom:0;
  height:78px;
  border-radius:18px;
  background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.72));
  box-shadow:0 0 0 1px rgba(255,255,255,.55) inset;
}
.chest .band{
  position:absolute;
  left:0; right:0;
  bottom:34px;
  height:14px;
  border-radius:12px;
  background:rgba(0,0,0,.06);
}
.chest .lock{
  position:absolute;
  left:50%;
  bottom:22px;
  transform:translateX(-50%);
  width:34px;
  height:26px;
  border-radius:10px;
  background:rgba(0,0,0,.10);
  box-shadow:0 0 0 1px rgba(255,255,255,.40) inset;
}
.chest .lid{
  position:absolute;
  left:0; right:0;
  top:0;
  height:66px;
  transform-origin:50% 100%;
  border-radius:18px;
  background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.72));
  box-shadow:0 0 0 1px rgba(255,255,255,.55) inset;
  animation: lidOpen .7s cubic-bezier(.2,.9,.2,1) .15s forwards;
}
@keyframes lidOpen{
  0%{ transform:rotateX(0deg) translateY(0); }
  100%{ transform:rotateX(72deg) translateY(-8px); }
}

.sparkles{
  position:absolute;
  left:50%;
  top:30px;
  transform:translateX(-50%);
  width:220px;
  height:160px;
  opacity:0;
  animation: spark .85s ease .20s forwards;
}
@keyframes spark{
  0%{ opacity:0; transform:translateX(-50%) scale(.8); }
  25%{ opacity:1; }
  100%{ opacity:0; transform:translateX(-50%) scale(1.08); }
}
.sparkles::before,
.sparkles::after{
  content:"‚ú®‚ú®‚ú®";
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  font-size:22px;
  letter-spacing:6px;
  opacity:.9;
  filter:drop-shadow(0 14px 26px rgba(0,0,0,.14));
}
.sparkles::before{ top:0; animation: floatUp .85s ease .20s forwards; }
.sparkles::after{ top:34px; font-size:18px; opacity:.75; animation: floatUp2 .85s ease .20s forwards; }
@keyframes floatUp{ to{ transform:translateX(-50%) translateY(-22px); opacity:0; } }
@keyframes floatUp2{ to{ transform:translateX(-50%) translateY(-34px); opacity:0; } }

@media (max-width:520px){
  .card{ padding:22px; }
  h1{ font-size:28px; }
  .giftTitle{ font-size:24px; }
  .giftSlide{ min-height:660px; }
  .giftHeader{ top:44%; }
  .tag{ font-size:11px; }
}
</style>
</head>

<body>

<canvas id="confetti"></canvas>

<div class="card">

  <!-- SLIDE 0 -->
  <div class="slide active">
    <div class="heroImage">
      <img id="imgHero" alt="">
    </div>
    <h1>Happy Birthday ma Ch√©riiiiiiie üéâ</h1>
    <p>M√™me si tu es loin, on voulait c√©l√©brer ce moment avec toi!</p>
    <button onclick="next()">D√©bloque la suite üîì</button>
  </div>

  <!-- SLIDE 1 -->
  <div class="slide">
    <h1>üíû De la part de</h1>
    <p>Lucie, Anthony, Chlo√© & Hortense.</p>
    <div class="squareBox">
      <img id="imgGroup" alt="">
    </div>
    <button onclick="next()">D√©bloque la suite üîì</button>
  </div>

  <!-- SLIDE 2 -->
  <div class="slide">
    <h1>On pense √† toi, et on veut que tu te d√©tendes...</h1>
    <p>Donc pour tes <b>27 ans</b>, on te souhaite.... : <b>un cr√¢ne bien d√©tendu.</b> (pas toi ‚û°Ô∏è üíÄ)</p>
    <div class="squareBox">
      <img id="imgOhlala" alt="">
    </div>
    <button onclick="next()">D√©couvre ton cadeau üéÅ</button>
  </div>

  <!-- SLIDE 3 -->
  <div class="slide giftSlide" id="giftSlide">

    <!-- reveal overlay -->
    <div class="revealOverlay" id="reveal">
      <div class="chest" aria-hidden="true">
        <div class="lid"></div>
        <div class="base"></div>
        <div class="band"></div>
        <div class="lock"></div>
        <div class="sparkles"></div>
      </div>
    </div>

    <div class="giftHeader">
      <div class="giftTitle">
        üíÜ‚Äç‚ôÄÔ∏è <span class="wiggle">Une S√©ance de Head Spa</span> üåü
      </div>

      <!-- ‚úÖ image DIRECTEMENT sous le titre -->
      <div class="miniPhoto">
        <img id="imgToiBientot" alt="">
      </div>

      <div class="giftStack">
        <div class="giftPill">
          Une s√©ance compl√®te incluant d√©tente profonde et soin capillaire.
        </div>
      </div>
    </div>

    <div class="giftFootnote">
      Merci de contacter <b>Mme Lucie Dubourdieu</b> pour r√©cup√©rer votre lot üë©‚Äç‚úàÔ∏è
    </div>

    <div class="floatZone" id="floatZone"></div>
  </div>

</div>

<script>
/* =========================
   MEDIA PATHS
   racine: monanniversaire.png / lessurvivors.jpg / bg.jpg / ohlala.jpg / toibientot.png
   fallback: /images/
   ========================= */
const MEDIA = {
  bases: ["", "images/"],
  hero: "monanniversaire.png",
  group: "lessurvivors.jpg",
  bg: "bg.jpg",
  ohlala: "ohlala.jpg",
  toibientot: "toibientot.png"
};

function setImgWithFallback(id, filename){
  const el = document.getElementById(id);
  if(!el) return;

  let i = 0;
  const tryNext = () => {
    if(i >= MEDIA.bases.length) return;
    el.src = MEDIA.bases[i] + filename;
    el.onerror = () => {
      el.onerror = null;
      i++;
      tryNext();
    };
  };
  tryNext();
}

function setBgWithFallback(filename){
  let i = 0;
  const tryNext = () => {
    if(i >= MEDIA.bases.length) return;
    const url = MEDIA.bases[i] + filename;

    const img = new Image();
    img.onload = () => {
      document.documentElement.style.setProperty("--bgImg", `url("${url}")`);
    };
    img.onerror = () => {
      i++;
      tryNext();
    };
    img.src = url;
  };
  tryNext();
}

(function initMedia(){
  setBgWithFallback(MEDIA.bg);
  setImgWithFallback("imgHero", MEDIA.hero);
  setImgWithFallback("imgGroup", MEDIA.group);
  setImgWithFallback("imgOhlala", MEDIA.ohlala);
  setImgWithFallback("imgToiBientot", MEDIA.toibientot);
})();

/* =========================
   CONFETTI
   - soft from slide 1+
   - + "burst" on gift reveal
   ========================= */
const Confetti = (function(){
  const c = document.getElementById("confetti");
  const ctx = c.getContext("2d");
  const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));

  function resize(){
    c.width = Math.floor(window.innerWidth * DPR);
    c.height = Math.floor(window.innerHeight * DPR);
    c.style.width = window.innerWidth + "px";
    c.style.height = window.innerHeight + "px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener("resize", resize);
  resize();

  const colors = ["#ff4d6d","#ffd166","#06d6a0","#118ab2","#9b5de5","#f15bb5","#00bbf9"];
  const pieces = [];
  const MAX = 180;

  let activeCount = 180;
  let alpha = 0.95;
  let speedMult = 1.0;
  let windMult = 1.0;

  function spawn(){
    return {
      x: Math.random()*window.innerWidth,
      y: -20 - Math.random()*window.innerHeight*0.35,
      r: 3 + Math.random()*4,
      w: 6 + Math.random()*8,
      h: 8 + Math.random()*12,
      vy: 1.4 + Math.random()*3.6,
      vx: -0.9 + Math.random()*1.8,
      rot: Math.random()*Math.PI*2,
      vr: (-0.10 + Math.random()*0.20),
      color: colors[(Math.random()*colors.length)|0],
      shape: Math.random() < 0.55 ? "rect" : "circle"
    };
  }
  for(let i=0;i<MAX;i++) pieces.push(spawn());

  function setMode(mode){
    if(mode === 0){
      activeCount = 180;
      alpha = 0.95;
      speedMult = 1.00;
      windMult = 1.00;
    }else{
      activeCount = 70;
      alpha = 0.28;
      speedMult = 0.45;
      windMult = 0.55;
    }
  }

  let target = {activeCount, alpha, speedMult, windMult};
  function setModeSoft(mode){
    setMode(mode);
    target = {activeCount, alpha, speedMult, windMult};
  }
  setModeSoft(0);

  function lerp(a,b,t){ return a + (b-a)*t; }

  const bursts = [];
  function burst(){
    const cx = window.innerWidth * (0.5 + (Math.random()*0.06 - 0.03));
    const cy = window.innerHeight * 0.45;
    const n = 120;

    for(let i=0;i<n;i++){
      const a = Math.random()*Math.PI*2;
      const s = 2.4 + Math.random()*6.2;
      bursts.push({
        x: cx,
        y: cy,
        vx: Math.cos(a)*s,
        vy: Math.sin(a)*s - (3.5 + Math.random()*3.5),
        rot: Math.random()*Math.PI*2,
        vr: (-0.22 + Math.random()*0.44),
        w: 5 + Math.random()*10,
        h: 6 + Math.random()*14,
        r: 2 + Math.random()*3.8,
        life: 60 + Math.random()*30,
        color: colors[(Math.random()*colors.length)|0],
        shape: Math.random() < 0.62 ? "rect" : "circle"
      });
    }
  }

  function step(){
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    activeCount = Math.round(lerp(activeCount, target.activeCount, 0.08));
    alpha      = lerp(alpha,      target.alpha,      0.08);
    speedMult  = lerp(speedMult,  target.speedMult,  0.08);
    windMult   = lerp(windMult,   target.windMult,   0.08);

    for(let i=0;i<activeCount;i++){
      const p = pieces[i];

      p.x += p.vx * windMult;
      p.y += p.vy * speedMult;
      p.rot += p.vr;

      p.vx += Math.sin(p.y*0.01 + p.rot) * 0.012 * windMult;

      if(p.y > window.innerHeight + 40){
        p.y = -30 - Math.random()*220;
        p.x = Math.random()*window.innerWidth;
        p.vy = 1.4 + Math.random()*3.6;
        p.vx = -0.9 + Math.random()*1.8;
      }

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.globalAlpha = alpha;

      ctx.fillStyle = p.color;
      if(p.shape === "rect"){
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      }else{
        ctx.beginPath();
        ctx.arc(0,0,p.r,0,Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
    }

    for(let i=bursts.length-1;i>=0;i--){
      const b = bursts[i];
      b.x += b.vx;
      b.y += b.vy;
      b.vy += 0.18;
      b.vx *= 0.985;
      b.rot += b.vr;
      b.life -= 1;

      const a = Math.max(0, Math.min(1, b.life/70));
      ctx.save();
      ctx.translate(b.x, b.y);
      ctx.rotate(b.rot);
      ctx.globalAlpha = 0.95 * a;

      ctx.fillStyle = b.color;
      if(b.shape === "rect"){
        ctx.fillRect(-b.w/2, -b.h/2, b.w, b.h);
      }else{
        ctx.beginPath();
        ctx.arc(0,0,b.r,0,Math.PI*2);
        ctx.fill();
      }
      ctx.restore();

      if(b.life <= 0 || b.y > window.innerHeight + 60) bursts.splice(i,1);
    }

    requestAnimationFrame(step);
  }
  step();

  return { setModeSoft, burst };
})();

/* =========================
   SLIDES + REVEAL
   ========================= */
let current=0;
const slides=document.querySelectorAll(".slide");

Confetti.setModeSoft(0);

function playReveal(){
  const r = document.getElementById("reveal");
  if(!r) return;
  r.classList.remove("show");
  void r.offsetWidth;
  r.classList.add("show");
  Confetti.burst();
}

function next(){
  slides[current].classList.remove("active");
  current++;
  slides[current].classList.add("active");

  Confetti.setModeSoft(current >= 1 ? 1 : 0);

  if(slides[current].id==="giftSlide"){
    playReveal();
    startMagnetic();
  }
}

/* =========================
   FLOAT / MAGNETIC ENGINE
   ========================= */

const items=[
  "Bain des pieds pr√©lassant aux herbes",
  "Massage relaxant Guasha",
  "Stimulation avec accessoires",
  "Anneau dor√© + infusion chaude",
  "Nettoyage / Exfoliation",
  "Serviette cr√©pitante & Shiatsu Bambou",
  "Masque hydratant sous vapeur",
  "Modelage bras Hot Stone",
  "Gel√©e capillaire Aloe",
  "√âtirements serviette chaude"
];

const baseEmojis=["üßñ‚Äç‚ôÄÔ∏è","üçÉ","üßò‚Äç‚ôÄÔ∏è","‚òÅÔ∏è","ü§ç"];
const emojis = baseEmojis.flatMap(e => [e,e]); // 10

let started=false;
const blobs=[];
const pointer={x:-9999,y:-9999,active:false};

function rand(a,b){return Math.random()*(b-a)+a;}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function startMagnetic(){
  if(started) return;
  started=true;

  const zone=document.getElementById("floatZone");

  zone.addEventListener("mousemove",e=>{
    const r=zone.getBoundingClientRect();
    pointer.x=((e.clientX-r.left)/r.width)*100;
    pointer.y=((e.clientY-r.top)/r.height)*100;
    pointer.active=true;
  });
  zone.addEventListener("mouseleave",()=>pointer.active=false);

  // zones interdites: bloc titre + image + pill + footnote
  const FORBIDDEN = [
    {x1:10, x2:90, y1:20, y2:78},
    {x1:12, x2:88, y1:86, y2:96}
  ];
  function insideRect(x,y,r){ return x>=r.x1 && x<=r.x2 && y>=r.y1 && y<=r.y2; }
  function isForbidden(x,y){ return FORBIDDEN.some(r=>insideRect(x,y,r)); }

  const TOP =    { x1:6, x2:94, y1:8,  y2:18 };
  const BOTTOM = { x1:6, x2:94, y1:80, y2:84 };

  function pickSpawn(area){
    let x,y,tries=0;
    do{
      x = rand(area.x1, area.x2);
      y = rand(area.y1, area.y2);
      tries++;
    } while(isForbidden(x,y) && tries<120);
    return {x,y};
  }

  const topEntries = [];
  const bottomEntries = [];

  const itemsTop = items.slice(0,5);
  const itemsBottom = items.slice(5,10);

  const emojisTop = emojis.slice(0,5);
  const emojisBottom = emojis.slice(5,10);

  itemsTop.forEach(t => topEntries.push({type:"tag", text:t}));
  emojisTop.forEach(e => topEntries.push({type:"emojiFloat", text:e}));

  itemsBottom.forEach(t => bottomEntries.push({type:"tag", text:t}));
  emojisBottom.forEach(e => bottomEntries.push({type:"emojiFloat", text:e}));

  shuffle(topEntries);
  shuffle(bottomEntries);

  function create(entry,i,area,delayBase){
    const el=document.createElement("div");
    el.className=entry.type;
    el.textContent=entry.text;
    zone.appendChild(el);

    const s = pickSpawn(area);

    const obj={
      el,
      baseX:s.x, baseY:s.y,
      x:s.x, y:s.y,
      vx:0, vy:0,
      phase:rand(0,Math.PI*2),
      drift:rand(0.10,0.22),
      area
    };

    blobs.push(obj);
    setTimeout(()=>el.classList.add("show"), delayBase + i*55);
  }

  topEntries.forEach((entry,i)=>create(entry,i,TOP,140));
  bottomEntries.forEach((entry,i)=>create(entry,i,BOTTOM,420));

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  const t = performance.now();

  const FORBIDDEN = [
    {x1:10, x2:90, y1:20, y2:78},
    {x1:12, x2:88, y1:86, y2:96}
  ];
  function insideRect(x,y,r){ return x>=r.x1 && x<=r.x2 && y>=r.y1 && y<=r.y2; }
  function isForbidden(x,y){ return FORBIDDEN.some(r=>insideRect(x,y,r)); }

  blobs.forEach(b=>{
    const levX = Math.sin(t*0.001 + b.phase) * (0.55 * (b.drift*10));
    const levY = Math.cos(t*0.0011 + b.phase) * (0.40 * (b.drift*10));

    const targetX = b.baseX + levX;
    const targetY = b.baseY + levY;

    b.vx += (targetX - b.x) * 0.02;
    b.vy += (targetY - b.y) * 0.02;

    if(pointer.active){
      const dx=b.x-pointer.x;
      const dy=b.y-pointer.y;
      const dist=Math.sqrt(dx*dx+dy*dy);
      if(dist < 26){
        const safeDist = Math.max(dist, 0.001);
        b.vx += (dx/safeDist) * 0.62;
        b.vy += (dy/safeDist) * 0.62;
      }
    }

    b.vx *= 0.90;
    b.vy *= 0.90;
    b.x += b.vx;
    b.y += b.vy;

    b.x = clamp(b.x, b.area.x1, b.area.x2);
    b.y = clamp(b.y, b.area.y1, b.area.y2);

    if(isForbidden(b.x,b.y)){
      const sX = rand(b.area.x1, b.area.x2);
      const sY = rand(b.area.y1, b.area.y2);
      b.x = sX; b.y = sY;
      b.baseX = sX; b.baseY = sY;
    }

    b.el.style.left = b.x + "%";
    b.el.style.top  = b.y + "%";
  });
}
</script>

</body>
</html>
